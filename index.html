<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Наш словарь</title>
  <style>
    :root { --bg: #0b0d12; --card: rgba(23, 26, 33, 0.85); --text: #e6e6eb; --muted: #9aa0aa; --accent: #7c7cff; --border: rgba(255,255,255,0.08); }
    body { margin: 0; min-height: 100vh; font-family: Inter, sans-serif; background: radial-gradient(1200px 600px at 10% 10%, #1a1d2b, transparent 60%), var(--bg); color: var(--text); padding: 20px; }
    header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; border-bottom: 1px solid var(--border); padding-bottom: 15px; }
    main { display: grid; grid-template-columns: 320px 1fr; gap: 30px; }
    .panel { background: var(--card); padding: 20px; border-radius: 18px; border: 1px solid var(--border); height: fit-content; }
    input, textarea { width: 100%; padding: 10px; margin: 8px 0; background: #000; border: 1px solid var(--border); border-radius: 10px; color: #fff; box-sizing: border-box; }
    button { width: 100%; padding: 12px; background: linear-gradient(135deg, #7c7cff, #9b7cff); border: none; border-radius: 10px; color: #fff; cursor: pointer; font-weight: bold; margin-top: 10px; }
    .card { background: var(--card); border: 1px solid var(--border); border-radius: 15px; padding: 15px; margin-bottom: 15px; }
    .card img { max-width: 100%; border-radius: 10px; margin-bottom: 10px; }
    .tag { font-size: 11px; background: rgba(124,124,255,0.2); color: #c6c8ff; padding: 3px 8px; border-radius: 5px; margin-right: 5px; }
    @media (max-width: 800px) { main { grid-template-columns: 1fr; } }
  </style>
</head>
<body>
  <header>
    <h1>Наш персональный словарь</h1>
    <button id="authBtn" style="width:auto; padding: 8px 15px;" onclick="toggleAuth()">Вход не выполнен</button>
  </header>

  <main>
    <section class="panel">
      <h2>Добавить слово</h2>
      <input id="titleInput" placeholder="Например: Ну это уже клиника" />
      <textarea id="descInput" rows="3" placeholder="Что это значит..."></textarea>
      <input id="tagsInput" placeholder="#мем, #сленг" />
      <input type="file" id="imageInput" accept="image/*" />
      <button onclick="addEntry()">Добавить в облако</button>
    </section>

    <section>
      <input type="text" id="searchInput" placeholder="Поиск по словам..." oninput="render()" style="padding:15px; border-radius:15px; margin-bottom:20px;">
      <div id="list"></div>
    </section>
  </main>

  <script>
    // Твоя рабочая ссылка
    const API_URL = 'https://unelicitable-bayleigh-nonmodificatory.ngrok-free.dev/entries';
    // Твой секретный ключ
    const MASTER_KEY = 'NO7nlFrFnIg8SvvlAn7MaIIReKidrEJhFUXX1Yq3DdzFzmPHGirhzJhAPIrJOm6KGMiJh2QXQIbalvBHByHf11Tk5NaMfYzd4CcKfZQM5sXVoiBcrwh6JvjxOXMTCTVk';

    let entries = [];

    // Загрузка данных
    async function load() {
        try {
            const res = await fetch(API_URL);
            entries = await res.json();
            render();
        } catch (e) {
            console.error("Ошибка подключения к серверу");
            document.getElementById('list').innerHTML = '<p style="color:red">Сервер не отвечает. Проверь ngrok!</p>';
        }
    }

    // Добавление записи
    async function addEntry() {
        const title = document.getElementById('titleInput').value.trim();
        if (!title) return alert("Введите название!");

        const formData = new FormData();
        formData.append('title', title);
        formData.append('desc', document.getElementById('descInput').value);
        formData.append('tags', JSON.stringify(document.getElementById('tagsInput').value.split(',').map(t => t.trim())));
        
        const fileInput = document.getElementById('imageInput');
        if (fileInput.files[0]) formData.append('image', fileInput.files[0]);

        const res = await fetch(API_URL, {
            method: 'POST',
            headers: { 'x-api-key': MASTER_KEY }, // Ключ отправляется автоматически
            body: formData
        });

        if (res.ok) {
            location.reload(); 
        } else {
            alert("Ошибка сохранения! Проверь логи сервера.");
        }
    }

    // Удаление
    async function removeEntry(id) {
        if (!confirm("Удалить из облака?")) return;
        await fetch(`${API_URL}/${id}`, {
            method: 'DELETE',
            headers: { 'x-api-key': MASTER_KEY }
        });
        load();
    }

    function render() {
        const q = document.getElementById('searchInput').value.toLowerCase();
        const html = entries.filter(e => e.title.toLowerCase().includes(q)).map(e => `
            <div class="card">
                ${e.image ? `<img src="${e.image}">` : ''}
                <h3>${e.title}</h3>
                <p>${e.desc}</p>
                <div>${(e.tags || []).map(t => `<span class="tag">${t}</span>`).join('')}</div>
                <button onclick="removeEntry(${e.id})" style="background:red; width:auto; font-size:10px; margin-top:10px;">Удалить</button>
            </div>
        `).join('');
        document.getElementById('list').innerHTML = html || '<p>Записей пока нет...</p>';
    }

    window.onload = load;
</script>
</body>
</html>
